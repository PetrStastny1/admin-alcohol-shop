<div class="users-page">
  <h2>👤 Uživatelé</h2>

  <div class="back-buttons">
    <button class="back-one-btn" (click)="goBackOneStep()">⬅ O krok zpět</button>
    <button class="back-btn" (click)="goBack()">⬅ Zpět na Dashboard</button>
  </div>

  <div class="new-user">
    <button class="add-btn" (click)="startNew()">➕ Přidat uživatele</button>
  </div>

  <div *ngIf="newUser" class="form-box">
    <div class="inner-form">
      <input [(ngModel)]="newUser.email" placeholder="Email" />
      <input [(ngModel)]="newUser.username" placeholder="Uživatelské jméno" />
      <input type="password" [(ngModel)]="newUser.password" placeholder="Heslo" />
      <select [(ngModel)]="newUser.role">
        <option [ngValue]="'user'">user</option>
        <option [ngValue]="'admin'">admin</option>
      </select>
      <button class="save-btn" (click)="saveNew()">💾 Uložit</button>
      <button class="cancel-btn" (click)="cancelNew()">✖ Zrušit</button>
    </div>
  </div>

  <table class="users-table" *ngIf="users.length > 0">
    <thead>
      <tr>
        <th class="email-col">Email</th>
        <th class="username-col">Uživatelské jméno</th>
        <th class="role-col">Role</th>
        <th class="created-col">Vytvořen</th>
        <th class="actions-col">Akce</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of pagedUsers" [ngClass]="{ editing: editingUser?.id === u.id }">
        <ng-container *ngIf="editingUser?.id === u.id; else viewMode">
          <td colspan="5">
            <div class="form-box">
              <div class="inner-form">
                <input [(ngModel)]="editingUser!.email" placeholder="Email" />
                <input [(ngModel)]="editingUser!.username" placeholder="Uživatelské jméno" />
                <input type="password" [(ngModel)]="editingUserPassword" placeholder="Nové heslo" />
                <select [(ngModel)]="editingUser!.role">
                  <option [ngValue]="'user'">user</option>
                  <option [ngValue]="'admin'">admin</option>
                </select>
                <button class="save-btn" (click)="saveEdit()">💾 Uložit</button>
                <button class="cancel-btn" (click)="cancelEdit()">✖ Zrušit</button>
              </div>
            </div>
          </td>
        </ng-container>
        <ng-template #viewMode>
          <td class="email-col">{{ u.email }}</td>
          <td class="username-col">{{ u.username }}</td>
          <td class="role-col">{{ u.role }}</td>
          <td class="created-col">{{ u.created_at | date: 'yyyy-MM-dd HH:mm' }}</td>
          <td class="actions-col">
            <button class="edit-btn" (click)="startEdit(u)">✏ Upravit</button>
            <button class="delete-btn" (click)="deleteUser(u.id)">🗑 Smazat</button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <div class="pagination">
    <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">⬅ Předchozí</button>
    <span>Stránka {{ currentPage }} z {{ totalPages }}</span>
    <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">Další ➡</button>
    <label>
      Záznamů na stránku:
      <select [(ngModel)]="pageSize" (ngModelChange)="changePageSize($event)">
        <option *ngFor="let size of pageSizes" [ngValue]="size">{{ size }}</option>
      </select>
    </label>
  </div>

  <p *ngIf="users.length === 0 && !loading">Žádní uživatelé nebyli nalezeni.</p>
</div>
