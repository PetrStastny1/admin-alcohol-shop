<div class="customers-page">
  <h2>👥 Zákazníci</h2>

  <button class="back-btn" (click)="goBack()">⬅ Zpět na Dashboard</button>

  <div class="new-customer">
    <button class="add-btn" (click)="startNew()">➕ Přidat zákazníka</button>
  </div>

  <div *ngIf="newCustomer" class="form-box">
    <div class="inner-form">
      <input [(ngModel)]="newCustomer!.name" placeholder="Jméno" />
      <input [(ngModel)]="newCustomer!.email" placeholder="Email" />
      <input [(ngModel)]="newCustomer!.phone" placeholder="Telefon" />
      <input [(ngModel)]="newCustomer!.address" placeholder="Adresa" />
      <button class="save-btn" (click)="saveNew()">💾 Uložit</button>
      <button class="cancel-btn" (click)="cancelNew()">✖ Zrušit</button>
    </div>
  </div>

  <table class="customers-table" *ngIf="customers$ | async as customers">
    <thead>
      <tr>
        <th class="id-col">ID</th>
        <th class="name-col">Jméno</th>
        <th class="email-col">Email</th>
        <th class="phone-col">Telefon</th>
        <th class="address-col">Adresa</th>
        <th class="orders-col">Objednávky</th>
        <th class="actions-col">Akce</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let cust of customers; trackBy: trackById"
        [ngClass]="{ editing: editingCustomer?.id === cust.id }"
        class="clickable-row"
        (click)="editingCustomer?.id === cust.id ? null : goToOrders(cust.id)"
      >
        <ng-container *ngIf="editingCustomer?.id === cust.id; else viewMode">
          <td colspan="7">
            <div class="form-box">
              <div class="inner-form">
                <input [(ngModel)]="editingCustomer!.name" placeholder="Jméno" />
                <input [(ngModel)]="editingCustomer!.email" placeholder="Email" />
                <input [(ngModel)]="editingCustomer!.phone" placeholder="Telefon" />
                <input [(ngModel)]="editingCustomer!.address" placeholder="Adresa" />
                <button
                  class="save-btn"
                  (click)="saveEdit(); $event.stopPropagation()"
                >
                  💾 Uložit
                </button>
                <button
                  class="cancel-btn"
                  (click)="cancelEdit(); $event.stopPropagation()"
                >
                  ✖ Zrušit
                </button>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-template #viewMode>
          <td class="id-col">{{ cust.id }}</td>
          <td class="name-col">{{ cust.name }}</td>
          <td class="email-col">{{ cust.email }}</td>
          <td class="phone-col">{{ cust.phone || '-' }}</td>
          <td class="address-col">{{ cust.address || '-' }}</td>
          <td class="orders-col">{{ cust.orders?.length || 0 }}</td>
          <td class="actions-col">
            <button
              class="edit-btn"
              (click)="startEdit(cust); $event.stopPropagation()"
            >
              ✏ Upravit
            </button>
            <button
              class="delete-btn"
              (click)="deleteCustomer(cust.id); $event.stopPropagation()"
            >
              🗑 Smazat
            </button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <p *ngIf="(customers$ | async)?.length === 0">
    Žádní zákazníci nebyli nalezeni.
  </p>

  <div *ngIf="errorMsg" class="error-box">
    ⚠️ {{ errorMsg }}
  </div>
</div>
