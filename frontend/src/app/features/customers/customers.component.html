<div class="customers-page">
  <h2>üë• Z√°kazn√≠ci</h2>

  <div class="page-header">
    <div class="back-buttons">
      <button class="back-one-btn" (click)="goBackOneStep()">‚¨Ö O krok zpƒõt</button>
      <button class="back-btn" (click)="goBack()">‚¨Ö Zpƒõt na Dashboard</button>
    </div>

    <div class="new-customer" *ngIf="isAdmin()">
      <button class="add-btn" (click)="startNew()">‚ûï P≈ôidat z√°kazn√≠ka</button>
    </div>
  </div>

  <div *ngIf="newCustomer && isAdmin()" class="form-box">
    <div class="inner-form">
      <input [(ngModel)]="newCustomer!.name" placeholder="Jm√©no" />
      <input [(ngModel)]="newCustomer!.email" placeholder="Email" />
      <input [(ngModel)]="newCustomer!.phone" placeholder="Telefon" />
      <input [(ngModel)]="newCustomer!.address" placeholder="Adresa" />
      <button class="save-btn" (click)="saveNew()">üíæ Ulo≈æit</button>
      <button class="cancel-btn" (click)="cancelNew()">‚úñ Zru≈°it</button>
    </div>
  </div>

  <table class="customers-table" *ngIf="pagedCustomers.length > 0">
    <thead>
      <tr>
        <th class="name-col">Jm√©no</th>
        <th class="email-col">Email</th>
        <th class="phone-col">Telefon</th>
        <th class="address-col">Adresa</th>
        <th class="orders-col">Objedn√°vky</th>
        <th class="actions-col" *ngIf="isAdmin()">Akce</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let cust of pagedCustomers; trackBy: trackById"
        [ngClass]="{ editing: editingCustomer?.id === cust.id }"
        class="clickable-row"
        (click)="editingCustomer?.id === cust.id ? null : goToOrders(cust.id)"
      >
        <ng-container *ngIf="editingCustomer?.id === cust.id && isAdmin(); else viewMode">
          <td colspan="6">
            <div class="form-box">
              <div class="inner-form">
                <input [(ngModel)]="editingCustomer!.name" placeholder="Jm√©no" />
                <input [(ngModel)]="editingCustomer!.email" placeholder="Email" />
                <input [(ngModel)]="editingCustomer!.phone" placeholder="Telefon" />
                <input [(ngModel)]="editingCustomer!.address" placeholder="Adresa" />
                <button class="save-btn" (click)="saveEdit(); $event.stopPropagation()">üíæ Ulo≈æit</button>
                <button class="cancel-btn" (click)="cancelEdit(); $event.stopPropagation()">‚úñ Zru≈°it</button>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-template #viewMode>
          <td class="name-col">{{ cust.name }}</td>
          <td class="email-col">{{ cust.email }}</td>
          <td class="phone-col">{{ cust.phone || '-' }}</td>
          <td class="address-col">{{ cust.address || '-' }}</td>
          <td class="orders-col">{{ cust.orders?.length || 0 }}</td>
          <td class="actions-col" *ngIf="isAdmin()">
            <button class="edit-btn" (click)="startEdit(cust); $event.stopPropagation()">‚úè Upravit</button>
            <button class="delete-btn" (click)="deleteCustomer(cust.id); $event.stopPropagation()">üóë Smazat</button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <p *ngIf="pagedCustomers.length === 0">
    ≈Ω√°dn√≠ z√°kazn√≠ci nebyli nalezeni.
  </p>

  <div class="pagination">
    <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">‚¨Ö P≈ôedchoz√≠</button>
    <span>Str√°nka {{ currentPage }} z {{ totalPages }}</span>
    <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">Dal≈°√≠ ‚û°</button>
    <label>
      Z√°znam≈Ø na str√°nku:
      <select [(ngModel)]="pageSize" (ngModelChange)="changePageSize($event)">
        <option *ngFor="let size of pageSizes" [ngValue]="size">{{ size }}</option>
      </select>
    </label>
  </div>

  <div *ngIf="errorMsg" class="error-box">
    ‚ö†Ô∏è {{ errorMsg }}
  </div>
</div>
