<div class="products-page">
  <h2>üçæ Produkty</h2>

  <button class="back-btn" (click)="goBack()">‚¨Ö Zpƒõt na Dashboard</button>

  <div class="new-product">
    <button class="add-btn" (click)="startNew()">‚ûï P≈ôidat produkt</button>
  </div>

  <div *ngIf="newProduct" class="form-box">
    <div class="inner-form">
      <select [(ngModel)]="newProduct.category" [ngModelOptions]="{standalone: true}">
        <option [ngValue]="undefined">-- Vyber kategorii --</option>
        <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat.name }}</option>
      </select>
      <input [(ngModel)]="newProduct.name" placeholder="N√°zev" />
      <input [(ngModel)]="newProduct.description" placeholder="Popis" />
      <input type="number" [(ngModel)]="newProduct.price" placeholder="Cena" />
      <button class="save-btn" (click)="saveNew()">üíæ Ulo≈æit</button>
      <button class="cancel-btn" (click)="cancelNew()">‚úñ Zru≈°it</button>
    </div>
  </div>

  <table class="products-table" *ngIf="products.length > 0">
    <thead>
      <tr>
        <th class="id-col">ID</th>
        <th class="category-col">Kategorie</th>
        <th class="name-col">N√°zev</th>
        <th class="desc-col">Popis</th>
        <th class="price-col">Cena</th>
        <th class="actions-col">Akce</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let prod of products" [ngClass]="{ editing: editingProduct?.id === prod.id }">
        <ng-container *ngIf="editingProduct?.id === prod.id; else viewMode">
          <td colspan="6">
            <div class="form-box">
              <div class="inner-form">
                <select [(ngModel)]="editingProduct!.category" [ngModelOptions]="{standalone: true}">
                  <option [ngValue]="undefined">-- Vyber kategorii --</option>
                  <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat.name }}</option>
                </select>
                <input [(ngModel)]="editingProduct!.name" placeholder="N√°zev" />
                <input [(ngModel)]="editingProduct!.description" placeholder="Popis" />
                <input type="number" [(ngModel)]="editingProduct!.price" placeholder="Cena" />
                <button class="save-btn" (click)="saveEdit()">üíæ Ulo≈æit</button>
                <button class="cancel-btn" (click)="cancelEdit()">‚úñ Zru≈°it</button>
              </div>
            </div>
          </td>
        </ng-container>
        <ng-template #viewMode>
          <td class="id-col">{{ prod.id }}</td>
          <td class="category-col">{{ prod.category?.name || '-' }}</td>
          <td class="name-col">{{ prod.name }}</td>
          <td class="desc-col">{{ prod.description }}</td>
          <td class="price-col">{{ prod.price }} Kƒç</td>
          <td class="actions-col">
            <button class="edit-btn" (click)="startEdit(prod)">‚úè Upravit</button>
            <button class="delete-btn" (click)="deleteProduct(prod.id)">üóë Smazat</button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <p *ngIf="products.length === 0 && !loading">≈Ω√°dn√© produkty nebyly nalezeny.</p>
</div>
