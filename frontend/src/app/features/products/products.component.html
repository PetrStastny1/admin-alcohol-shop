<div class="products-page">
  <h2>üçæ Produkty</h2>

  <div class="back-buttons">
    <button class="back-one-btn" (click)="goBackOneStep()">‚¨Ö O krok zpƒõt</button>
    <button class="back-btn" (click)="goBack()">‚¨Ö Zpƒõt na Dashboard</button>
  </div>

  <div class="new-product" *ngIf="isAdmin()">
    <button class="add-btn" (click)="startNew()">‚ûï P≈ôidat produkt</button>
  </div>

  <div *ngIf="newProduct" class="form-box">
    <div class="inner-form">
      <select [(ngModel)]="newProduct.category" [compareWith]="compareCategory">
        <option [ngValue]="undefined">-- Vyber kategorii --</option>
        <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat.name }}</option>
      </select>
      <input [(ngModel)]="newProduct.name" placeholder="N√°zev" />
      <input [(ngModel)]="newProduct.description" placeholder="Popis" />
      <input type="number" [(ngModel)]="newProduct.price" placeholder="Cena" min="0" />
      <input type="number" [(ngModel)]="newProduct.stock" placeholder="Sklad" min="0" />
      <button class="save-btn" (click)="saveNew()">üíæ Ulo≈æit</button>
      <button class="cancel-btn" (click)="cancelNew()">‚úñ Zru≈°it</button>
    </div>
  </div>

  <table class="products-table" *ngIf="products.length > 0">
    <thead>
      <tr>
        <th class="category-col">Kategorie</th>
        <th class="name-col">N√°zev</th>
        <th class="desc-col">Popis</th>
        <th class="price-col">Cena</th>
        <th class="stock-col">Sklad</th>
        <th class="actions-col" *ngIf="isAdmin()">Akce</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let prod of pagedProducts" [ngClass]="{ editing: editingProduct?.id === prod.id }">
        <ng-container *ngIf="editingProduct?.id === prod.id; else viewMode">
          <td colspan="6">
            <div class="form-box">
              <div class="inner-form">
                <select [(ngModel)]="editingProduct!.category" [compareWith]="compareCategory">
                  <option [ngValue]="undefined">-- Vyber kategorii --</option>
                  <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat.name }}</option>
                </select>
                <input [(ngModel)]="editingProduct!.name" placeholder="N√°zev" />
                <input [(ngModel)]="editingProduct!.description" placeholder="Popis" />
                <input type="number" [(ngModel)]="editingProduct!.price" placeholder="Cena" min="0" />
                <input type="number" [(ngModel)]="editingProduct!.stock" placeholder="Sklad" min="0" />
                <button class="save-btn" (click)="saveEdit()">üíæ Ulo≈æit</button>
                <button class="cancel-btn" (click)="cancelEdit()">‚úñ Zru≈°it</button>
              </div>
            </div>
          </td>
        </ng-container>
        <ng-template #viewMode>
          <td class="category-col">{{ prod.category?.name || '-' }}</td>
          <td class="name-col">{{ prod.name }}</td>
          <td class="desc-col">{{ prod.description }}</td>
          <td class="price-col">{{ prod.price }} Kƒç</td>
          <td class="stock-col">{{ prod.stock }}</td>
          <td class="actions-col" *ngIf="isAdmin()">
            <button class="edit-btn" (click)="startEdit(prod)">‚úè Upravit</button>
            <button class="delete-btn" (click)="deleteProduct(prod.id)">üóë Smazat</button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <p *ngIf="products.length === 0 && !loading">≈Ω√°dn√© produkty nebyly nalezeny.</p>

  <div class="pagination">
    <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">‚¨Ö P≈ôedchoz√≠</button>
    <span>Str√°nka {{ currentPage }} z {{ totalPages }}</span>
    <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">Dal≈°√≠ ‚û°</button>
    <label>
      Z√°znam≈Ø na str√°nku:
      <select [(ngModel)]="pageSize" (ngModelChange)="changePageSize($event)">
        <option *ngFor="let size of pageSizes" [ngValue]="size">{{ size }}</option>
      </select>
    </label>
  </div>
</div>
